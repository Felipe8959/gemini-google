from transformers import BartForConditionalGeneration, BartTokenizer
import pandas as pd

# Carregue a base de dados (exemplo com um arquivo CSV)
df = pd.read_csv('manifestacoes.csv')

# Carregue o modelo BART e o tokenizer (transforma texto em tokens para o modelo processar)
model_name = "facebook/bart-large-cnn"
model = BartForConditionalGeneration.from_pretrained(model_name)
tokenizer = BartTokenizer.from_pretrained(model_name)

# Função para gerar resumo
def gerar_resumo(manifestacoes):
    # Tokenize o texto (converte para uma sequência de números para o modelo)
    inputs = tokenizer(manifestacoes, return_tensors="pt", max_length=1024, truncation=True)
    
    # Gerar o resumo
    summary_ids = model.generate(inputs["input_ids"], num_beams=4, max_length=150, early_stopping=True)
    
    # Converter os tokens de volta para texto
    resumo = tokenizer.decode(summary_ids[0], skip_special_tokens=True)
    
    return resumo

# Combine as descrições das manifestações em um único texto
manifestacoes_texto = " ".join(df['DESCRICAO DA MANIFESTACAO'].tolist())

# Gerar o resumo
resumo = gerar_resumo(manifestacoes_texto)

# Exibir o resumo
print("Resumo dos principais pontos a melhorar:")
print(resumo)
