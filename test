import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

# ==========================================
# 1. GERANDO DADOS FICTÍCIOS (df_reclamacoes)
# ==========================================
np.random.seed(42) # Para garantir que o gráfico seja sempre igual

# Simulando 1000 reclamações
n_records = 1000

# Gerando uma distribuição exponencial (realista para atendimento)
# A maioria dos valores será baixa (0, 1, 2 dias), com uma cauda longa até 20
# scale=3.5 controla o "decaimento" da curva
dias = np.random.exponential(scale=3.5, size=n_records).astype(int)

# Forçando o limite de 20 dias (sua regra atual)
dias = np.clip(dias, 0, 20)

df_reclamacoes = pd.DataFrame({
    'id_reclamacao': range(1, n_records + 1),
    'dias_ate_reclamar': dias,
    'assunto': np.random.choice(
        ['Numerário', 'Cartão Retido', 'Divergência', 'Tarifa', 'Outros'], 
        n_records
    )
})

# ==========================================
# 2. ANÁLISE ESTATÍSTICA (DECISÃO DO CORTE)
# ==========================================
print("--- Estatísticas de Latência (Dias) ---")
# Calculando os percentis chave
stats = df_reclamacoes['dias_ate_reclamar'].describe(percentiles=[0.5, 0.75, 0.80, 0.90, 0.95])
print(stats)

# Pegando o valor que representa 90% dos casos (Corte Sugerido)
corte_sugerido = int(stats['90%'])
print(f"\n> Sugestão de Corte (Cobre 90% dos casos): {corte_sugerido} dias")
print(f"> Sua régua atual: 20 dias")

# ==========================================
# 3. VISUALIZAÇÃO (HISTOGRAMA + COTOVELO)
# ==========================================
plt.figure(figsize=(12, 6))

# Plotando o Histograma
sns.histplot(
    data=df_reclamacoes, 
    x='dias_ate_reclamar', 
    bins=21,        # 0 a 20 dias
    kde=True,       # Linha de densidade suave
    color='skyblue',
    edgecolor='black',
    alpha=0.6
)

# Adicionando linha do seu corte ATUAL (20 dias)
plt.axvline(x=20, color='gray', linestyle=':', linewidth=2, label='Sua Régua Atual (20 dias)')

# Adicionando linha da SUGESTÃO (Ex: D+7 ou D+8 baseado nos dados gerados)
plt.axvline(x=corte_sugerido, color='red', linestyle='--', linewidth=2, label=f'Corte Sugerido 90% (D+{corte_sugerido})')

# Texto explicativo na área de "Ruído"
plt.text(
    x=corte_sugerido + 1, 
    y=100, 
    s='Area de Risco:\nProváveis Falsos Positivos\n(Ruído)', 
    color='red', 
    fontsize=10,
    style='italic'
)

# Títulos e Labels
plt.title('Distribuição Temporal: Quanto tempo o cliente demora para reclamar?', fontsize=14)
plt.xlabel('Dias após Interação no Totem', fontsize=12)
plt.ylabel('Volume de Reclamações', fontsize=12)
plt.xlim(0, 21)
plt.legend()
plt.grid(axis='y', alpha=0.3)

plt.tight_layout()
plt.show()
