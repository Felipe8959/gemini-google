import re
from pyspark.sql.functions import udf
from pyspark.sql.types import StringType

# Função para remover caracteres especiais
def remove_special_characters(text):
    # Utiliza regex para remover caracteres especiais, mantendo letras, números e espaços
    return re.sub(r'[^A-Za-z0-9áàãâéêíóôõúç ]+', '', text)

# Registrando a UDF
remove_special_characters_udf = udf(remove_special_characters, StringType())

# Aplicando a UDF ao DataFrame
df_cleaned = df.withColumn("cleaned_text", remove_special_characters_udf(col("texto_cliente")))

# Mostrando o DataFrame com texto limpo
df_cleaned.show(truncate=False)
